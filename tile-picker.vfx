REQUIRE %idir%/painter.vfx

class: %tile-picker
    %element derive
    prop ts :ref %tileset
    prop tile#
    
    || : the-bmp  ts @ dup if >bmp @ then ;
    || : the-tile  ts @ dup if tile# @ tile then ;

    :: click-box@
        abspos the-bmp bmpwh 2>p box ;

    :: _process
        using? bolted? not and -exit
        me hovered = -exit
        lmb held? <space> held? not and if
            pmouse abspos 2- 2>i ts @ xy>tile tile# !
            ?painter ?dup if the-tile swap select then
        then ;

    :: _draw
        the-bmp put
        the-tile bmpxy +at  
        ts @ >tw 2@ 2>p white rect
        \ the-bmp id>bmp ?dup -exit >touched @ if  
            e{ me click-box@ 2over 2- 2swap atp white 0.25 ppena! rect e} 
        \ then 
        \ ?painter ?dup if white-connector then ;
        ;

    :: forth@ ( - a len )
        ts @ body>name f" %s ts !" ;

class;

: *tile-picker ( tileset - %tile-picker )
    %tile-picker *add { ts ! me } ;