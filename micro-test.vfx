REQUIRE %idir%/microcodes.vfx
REQUIRE %vfxland5%/supershow/stage.vfx

: *kpress ( key xt - ability )
    %ability add { kp ! k ! me } ;

c: %gravity %move [non-decaying] ;
%gravity >template { 90. ang ! 0.03 acc ! }

c: %rando %origin startx starty ;
0 %rando :construct micro:construct x 2@ startx 2! ;

: *rando
    %rando add {{
        \ 0 ICON_SPACING at
        <del> [: me unload ;] *kpress {{ }}
        <enter> [: startx 2@ x 2! ;] *kpress {{ }}   \ couples this to a rando
        \ %gravity add { }
        %move add {{ 
            %rep add {{
                [: 1.0 val ! 360. rnd ang ! ;] xt !
                %ability add {{
                    <enter> k !
                    [: 0. val ! ;] kp !
                    [: 1. val ! dur @ t ! ;] kr !
                }}
            }}
            %ability add {{
                <enter> k !
                [: 1. val ! ;] kh !
            }}
        }}
        %micro add {{
            %micro add {{ }}
        }}
    me }} ;

: test 
    machines {{
        64 64 at 
        \ *rando {{
\            *rando {{ }}
        \ }}
        \ *rando {{
            \ *rando {{ }}
        \ }}
        \ *rando {{
        \     *rando {{ }}
        \ }}
        \ *rando {{
        \     *rando {{ }}
        \ }}
        32 200 at
        %origin add {{ 
            %move add {{ }}
            %ability add {{ }}
            %rep add {{ }}
            %timeout add {{ }}
            %neuron add {{ }}
            %hitbox add {{ }} \ -8. -8. x 2+!  16. 16. w 2! }}
        }}
    }}
;

\ -- Panel/label/Number test ---------------------------------------------------

test
160 20 at 
%panel make constant panel
panel machines unshift
panel {
    150. 100. w 2!
    10 10 at
    s" Hello, my baby!" *label constant label
    0 16 +at 
    123 *int redef constant int
    0 16 +at 
    123.0 *fixed redef constant fixed

    0 16 +at 
    s" x: " *label drop
    32 0 +at
    0 *fixed constant fixed-x
    panel >x fixed-x >ra !

    -32 16 +at 
    s" y: " *label drop
    32 0 +at
    0 *fixed constant fixed-y
    panel >y fixed-y >ra !
}

\ panel inspect

\ -- Menu Test -----------------------------------------------------------------

\ 10 120 at *menu {
\     me [: 1 . me .summary cr ;] s" Menu item 1" +menu-item { }
\     me [: 2 . me .summary cr ;] s" Menu item 2" +menu-item { }
\     me [: 3 . me .summary cr ;] s" Menu item 3" +menu-item { }
\ }

\ -- Instructions---------------------------------------------------------------

cr
cr
." Controls: " cr
."  LMB: click/drag" cr
."  Shift+RMB: inspect" cr
."  Del: delete selected" cr